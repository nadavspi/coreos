{
  "ignition": {
    "version": "3.4.0"
  },
  "storage": {
    "disks": [
      {
        "device": "/dev/disk/by-id/coreos-boot-disk",
        "partitions": [
          {
            "label": "root",
            "number": 4,
            "resize": true,
            "sizeMiB": 8192
          },
          {
            "label": "var",
            "sizeMiB": 0
          }
        ],
        "wipeTable": false
      }
    ],
    "files": [
      {
        "overwrite": true,
        "path": "/usr/local/bin/k3s",
        "contents": {
          "source": "https://github.com/k3s-io/k3s/releases/download/v1.29.0%2Bk3s1/k3s",
          "verification": {
            "hash": "sha256-eea895a961fc8bdfeb42e634cb208e5637da8643c7fd1a1b5657ff76415a4c7a"
          }
        },
        "mode": 493
      },
      {
        "path": "/etc/rancher/k3s/kubelet.config",
        "contents": {
          "compression": "",
          "source": "data:,apiVersion%3A%20kubelet.config.k8s.io%2Fv1beta1%0Akind%3A%20KubeletConfiguration%0AshutdownGracePeriod%3A%2060s%0AshutdownGracePeriodCriticalPods%3A%2010s%0A"
        },
        "mode": 420
      },
      {
        "path": "/etc/yum.repos.d/kubernetes.repo",
        "contents": {
          "compression": "gzip",
          "source": "data:;base64,H4sIAAAAAAAC/4yNsQoCMRBE+3yFhW0SrAThvsBPEIu9vWEPktwuyaXI34soZ+tUwzC890h9Rt2woz3dRgXT/RjcTA295mndd2u3GI04kaAFztqXIKqSEVhLHL3ECtMWfzyPfPXnN4Mqrw4bzRnLdHFiwis4fWrC+FOwKMdqxX9fPmEEMTkdca8AAAD//3LuEQXOAAAA"
        },
        "mode": 420
      },
      {
        "path": "/etc/yum.repos.d/rancher-k3s-common.repo",
        "contents": {
          "compression": "gzip",
          "source": "data:;base64,H4sIAAAAAAAC/3TNsa7CMAyF4T1P0fHeoTVVF4SUiZGNFSGUGqup0sSRnQ59e1SC2Bit7+j3TVxCT9KGQVvkGDm1Wty40N0kF8leqzeXQZvz25u/Ovg3o1NaZbG+lKwnAMmx+/S6mSEMCnUKtQxIqbDCERI7QW8o7fq0vZnyhJ4w2N4IZX5878NOgbZfT/I6LjN2gTbzCgAA//90QUSlzAAAAA=="
        },
        "mode": 420
      }
    ],
    "filesystems": [
      {
        "device": "/dev/disk/by-partlabel/var",
        "format": "xfs",
        "path": "/var",
        "wipeFilesystem": false
      }
    ]
  },
  "systemd": {
    "units": [
      {
        "contents": "# Generated by Butane\n[Unit]\nRequires=systemd-fsck@dev-disk-by\\x2dpartlabel-var.service\nAfter=systemd-fsck@dev-disk-by\\x2dpartlabel-var.service\n\n[Mount]\nWhere=/var\nWhat=/dev/disk/by-partlabel/var\nType=xfs\n\n[Install]\nRequiredBy=local-fs.target",
        "enabled": true,
        "name": "var.mount"
      },
      {
        "contents": "[Unit]\nDescription=Lightweight Kubernetes\nDocumentation=https://k3s.io\nWants=network-online.target\nAfter=network-online.target\n\n[Install]\nWantedBy=multi-user.target\n\n[Service]\nType=notify\nEnvironmentFile=-/etc/default/%N\nEnvironmentFile=-/etc/sysconfig/%N\nEnvironmentFile=-/etc/systemd/system/k3s.service.env\nKillMode=process\nDelegate=yes\n# Having non-zero Limit*s causes performance problems due to accounting overhead\n# in the kernel. We recommend using cgroups to do container-local accounting.\nLimitNOFILE=1048576\nLimitNPROC=infinity\nLimitCORE=infinity\nTasksMax=infinity\nTimeoutStartSec=0\nRestart=always\nRestartSec=5s\nExecStartPre=/bin/sh -xc '! /usr/bin/systemctl is-enabled --quiet nm-cloud-setup.service'\nExecStartPre=-/sbin/modprobe br_netfilter\nExecStartPre=-/sbin/modprobe overlay\nExecStart=/usr/local/bin/k3s \\\n    server \\\n  --disable \\\n  traefik \\\n  --disable \\\n  servicelb \\\n  --server https://oakland:6443 \\\n  --token-file /root/token\n\n[Service]\nTimeoutStopFailureMode=abort\n",
        "enabled": false,
        "name": "k3s.service"
      }
    ]
  }
}
